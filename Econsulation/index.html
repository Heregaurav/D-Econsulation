<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Consultation Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .shadow-2xl {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .hover\:shadow-3xl:hover {
            box-shadow: 0 35px 60px -15px rgba(0, 0, 0, 0.3);
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Floating animation for word cloud */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        .word-float {
            animation: float infinite ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">
    <div id="root" class="flex flex-col lg:flex-row h-screen">

        <!-- Left sidebar – drafts (hidden on small screens, shown on large) -->
        <aside id="sidebar" class="hidden lg:flex w-72 bg-slate-900 text-slate-100 flex-col shadow-lg transition-all duration-300">
            <div class="p-6 border-b border-slate-700">
                <h1 class="text-3xl font-serif font-semibold text-white">E-Consultation</h1>
                <p class="text-xs text-slate-400 mt-1">Sentiment Analysis</p>
            </div>
            <div id="draft-list-desktop" class="flex-1 overflow-y-auto"></div>
            <div class="p-6 border-t border-slate-700">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-indigo-700 text-white flex items-center justify-center text-sm font-bold shrink-0 shadow-md">A</div>
                    <div>
                        <p class="text-sm font-semibold text-white">Admin</p>
                        <p class="text-xs text-slate-400">admin@gov.in</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Right area – tabs + content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top bar - Now with responsive background -->
            <header class="bg-slate-900 lg:bg-white border-b border-gray-200 px-4 sm:px-8 py-4 sm:py-6 shadow-sm flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <!-- Mobile dropdown for drafts -->
                    <div class="lg:hidden relative">
                        <button id="drafts-toggle" class="px-4 py-2 text-sm rounded-xl font-medium bg-slate-700 text-slate-300 hover:bg-slate-800 transition-colors">
                            Drafts
                            <svg class="ml-1 w-4 h-4 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                        </button>
                        <div id="drafts-menu" class="absolute z-50 top-full left-0 mt-2 w-56 bg-slate-800 rounded-lg shadow-xl border border-slate-700 hidden">
                            <!-- Draft list will be rendered here via JS -->
                        </div>
                    </div>
                    <!-- New mobile-specific heading, hidden on large screens -->
                    <h2 class="lg:hidden text-lg sm:text-2xl font-bold text-white">E-Consultation</h2>
                    <!-- Original dynamic heading for larger screens -->
                    <div class="hidden lg:block">
                        <h2 id="draft-title" class="text-lg sm:text-2xl font-bold text-gray-800"></h2>
                        <p id="draft-dates" class="text-xs sm:text-sm text-gray-500 mt-1"></p>
                    </div>
                </div>
                <!-- Tabs - Adjusted for both dark and light backgrounds -->
                <nav class="flex flex-wrap justify-center gap-2 p-1 bg-slate-800 lg:bg-gray-100 rounded-xl">
                    <button id="tab-dashboard" data-tab="dashboard" class="px-3 sm:px-5 py-2 text-sm rounded-lg font-medium transition-colors bg-indigo-700 text-white shadow-md hover:bg-indigo-800">Dashboard</button>
                    <button id="tab-comments" data-tab="comments" class="px-3 sm:px-5 py-2 text-sm rounded-lg font-medium transition-colors text-slate-300 lg:text-gray-600 hover:bg-slate-700 lg:hover:bg-gray-200">Comments</button>
                    <button id="tab-analytics" data-tab="analytics" class="px-3 sm:px-5 py-2 text-sm rounded-lg font-medium transition-colors text-slate-300 lg:text-gray-600 hover:bg-slate-700 lg:hover:bg-gray-200">Analytics</button>
                    <button id="tab-settings" data-tab="settings" class="px-3 sm:px-5 py-2 text-sm rounded-lg font-medium transition-colors text-slate-300 lg:text-gray-600 hover:bg-slate-700 lg:hover:bg-gray-200">Settings</button>
                </nav>
            </header>

            <!-- Content area -->
            <main id="main-content" class="flex-1 p-4 sm:p-8 overflow-y-auto"></main>
        </div>
    </div>

    <script>
        const Card = (children, className = '') => `<div class="bg-white rounded-2xl p-4 sm:p-6 shadow-md border border-gray-100 transition-all duration-300 hover:shadow-xl ${className}">${children}</div>`;
        const Pill = (children, onClick = '', className = '') => `<span onclick="${onClick}" class="px-3 py-1 text-xs rounded-full font-semibold cursor-pointer transition-colors duration-200 ${className}">${children}</span>`;
        const Btn = (children, onClick = '', className = '') => `<button onclick="${onClick}" class="flex items-center gap-1 px-4 py-2 text-sm rounded-xl font-medium border border-transparent bg-white text-gray-700 transition-all duration-300 hover:bg-gray-100 hover:shadow-md active:scale-95 ${className}">${children}</button>`;

        const lucideIcons = {
            ThumbsUp: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up"><path d="M7 10v12l10.5-11L14 1h-4a2 2 0 0 0-2 2v2H2c-1.1 0-2 .9-2 2v3c0 1.1.9 2 2 2h4.5a2.5 2.5 0 0 1 2.5 2.5v1.5a1.5 1.5 0 0 0 3 0V11a2.5 2.5 0 0 1 2.5-2.5h2.5c1.1 0 2 .9 2 2v6c0 1.1-.9 2-2 2H7"></path></svg>',
            ThumbsDown: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-down"><path d="M17 14V2h-4a2 2 0 0 0-2 2v2H2c-1.1 0-2 .9-2 2v3c0 1.1.9 2 2 2h4.5a2.5 2.5 0 0 1 2.5 2.5v1.5a1.5 1.5 0 0 0 3 0V14a2.5 2.5 0 0 1 2.5-2.5h2.5c1.1 0 2 .9 2 2v6c0 1.1-.9 2-2 2H17"></path></svg>',
            Minus: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-minus"><path d="M5 12h14"/></svg>',
            Activity: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>',
            Plus: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>',
            Filter: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-filter"><polygon points="22 13 22 13 2 13 2 13 9 22 15 22 22 13"/></svg>',
            Download: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>',
            Edit: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',
            Trash2: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6l3 15h12l3-15H3z"/><path d="M6 6v-1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/><line x1="2" x2="22" y1="6" y2="6"/></svg>',
            Eye: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2 12s5-7 10-7 10 7 10 7-5 7-10 7-10-7-10-7z"/><circle cx="12" cy="12" r="3"/></svg>',
            Send: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>',
            Bot: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot"><path d="M12 8V4H8a2 2 0 0 0-2 2v2"/><path d="M16 8V4h4a2 2 0 0 1 2 2v2"/><path d="M10 21.2v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4"/><path d="M4 17h16"/><rect x="8" y="10" width="8" height="7" rx="1"/></svg>',
        };

        const initialDrafts = [
            {
                id: 1,
                title: 'Healthcare Reform 2025',
                startDate: '2025-08-01',
                endDate: '2025-10-01',
                description: 'Public consultation on the new federal healthcare framework',
            },
            {
                id: 2,
                title: 'Urban Mobility Policy',
                startDate: '2025-09-10',
                endDate: '2025-11-10',
                description: 'Feedback cycle for sustainable transport incentives',
            },
        ];

        const draftData = {
            1: {
                sentimentStats: [
                    { title: 'Positive', value: '2,847', change: '+15.2%', trend: 'up', color: 'bg-teal-600', icon: 'ThumbsUp' },
                    { title: 'Negative', value: '1,234', change: '-8.1%', trend: 'down', color: 'bg-red-700', icon: 'ThumbsDown' },
                    { title: 'Neutral', value: '3,456', change: '+12%', trend: 'up', color: 'bg-slate-500', icon: 'Minus' },
                    { title: 'Total', value: '7,537', change: '+18.3%', trend: 'up', color: 'bg-indigo-700', icon: 'Activity' },
                ],
                wordCloudData: [
                    { word: 'policy', frequency: 45 },
                    { word: 'citizens', frequency: 38 },
                    { word: 'government', frequency: 35 },
                    { word: 'support', frequency: 32 },
                    { word: 'reform', frequency: 28 },
                    { word: 'healthcare', frequency: 25 },
                ],
                commentData: [
                    {
                        id: 1,
                        author: 'John Doe',
                        email: 'john@example.com',
                        comment: 'This policy is excellent and will benefit many citizens. I fully support this initiative.',
                        sentiment: 'Positive',
                        confidence: '95%',
                        date: '2024-01-15',
                        keywords: ['excellent', 'support', 'benefit'],
                    },
                    {
                        id: 2,
                        author: 'Jane Smith',
                        email: 'jane@example.com',
                        comment: 'The timeline for implementation seems too aggressive. What about the rural areas?',
                        sentiment: 'Negative',
                        confidence: '88%',
                        date: '2024-01-16',
                        keywords: ['timeline', 'aggressive', 'rural areas'],
                    },
                    {
                        id: 3,
                        author: 'Peter Jones',
                        email: 'peter@example.com',
                        comment: 'It is a good start, but more details are needed on the financial impact.',
                        sentiment: 'Neutral',
                        confidence: '75%',
                        date: '2024-01-17',
                        keywords: ['good start', 'details', 'financial impact'],
                    },
                    {
                        id: 4,
                        author: 'Mary White',
                        email: 'mary@example.com',
                        comment: 'The plan to increase public transport is a very positive step forward for our city.',
                        sentiment: 'Positive',
                        confidence: '91%',
                        date: '2024-01-18',
                        keywords: ['public transport', 'positive step', 'city'],
                    },
                    {
                        id: 5,
                        author: 'David Wilson',
                        email: 'david@example.com',
                        comment: 'I am not convinced this tax reform will help low-income families.',
                        sentiment: 'Negative',
                        confidence: '85%',
                        date: '2024-01-19',
                        keywords: ['tax reform', 'low-income', 'families'],
                    },
                    {
                        id: 6,
                        author: 'Sarah Brown',
                        email: 'sarah@example.com',
                        comment: 'The new policy is a good effort, but there are still many unanswered questions.',
                        sentiment: 'Neutral',
                        confidence: '78%',
                        date: '2024-01-20',
                        keywords: ['new policy', 'unanswered questions'],
                    },
                ],
            },
            2: {
                sentimentStats: [
                    { title: 'Positive', value: '1,560', change: '+8.2%', trend: 'up', color: 'bg-teal-600', icon: 'ThumbsUp' },
                    { title: 'Negative', value: '2,100', change: '+18.1%', trend: 'up', color: 'bg-red-700', icon: 'ThumbsDown' },
                    { title: 'Neutral', value: '4,500', change: '-2.5%', trend: 'down', color: 'bg-slate-500', icon: 'Minus' },
                    { title: 'Total', value: '8,160', change: '+1.3%', trend: 'up', color: 'bg-indigo-700', icon: 'Activity' },
                ],
                wordCloudData: [
                    { word: 'transport', frequency: 55 },
                    { word: 'public', frequency: 48 },
                    { word: 'infrastructure', frequency: 40 },
                    { word: 'city', frequency: 32 },
                    { word: 'lanes', frequency: 28 },
                    { word: 'buses', frequency: 25 },
                ],
                commentData: [
                    {
                        id: 7,
                        author: 'Michael Ray',
                        email: 'michael@example.com',
                        comment: 'The plan for new bus lanes is a great idea to reduce traffic congestion.',
                        sentiment: 'Positive',
                        confidence: '92%',
                        date: '2024-02-01',
                        keywords: ['bus lanes', 'great idea', 'traffic'],
                    },
                    {
                        id: 8,
                        author: 'Emily Chen',
                        email: 'emily@example.com',
                        comment: 'I am concerned about the budget for this project. Will it cause tax increases?',
                        sentiment: 'Negative',
                        confidence: '89%',
                        date: '2024-02-02',
                        keywords: ['budget', 'tax increases'],
                    },
                    {
                        id: 9,
                        author: 'Robert Lee',
                        email: 'robert@example.com',
                        comment: 'The focus on cycling is a step in the right direction, but more bike racks are needed.',
                        sentiment: 'Neutral',
                        confidence: '78%',
                        date: '2024-02-03',
                        keywords: ['cycling', 'bike racks'],
                    },
                    {
                        id: 10,
                        author: 'Jessica Adams',
                        email: 'jessica@example.com',
                        comment: 'The new transport incentives are a fantastic way to promote eco-friendly travel.',
                        sentiment: 'Positive',
                        confidence: '96%',
                        date: '2024-02-04',
                        keywords: ['transport incentives', 'fantastic', 'eco-friendly'],
                    },
                    {
                        id: 11,
                        author: 'Chris Evans',
                        email: 'chris@example.com',
                        comment: 'Closing off roads for pedestrians will severely impact my commute. This is a bad idea.',
                        sentiment: 'Negative',
                        confidence: '90%',
                        date: '2024-02-05',
                        keywords: ['closing roads', 'commute', 'bad idea'],
                    },
                    {
                        id: 12,
                        author: 'Laura Green',
                        email: 'laura@example.com',
                        comment: 'I need to know more about the proposed scooter sharing program before I can support it.',
                        sentiment: 'Neutral',
                        confidence: '81%',
                        date: '2024-02-06',
                        keywords: ['scooter sharing', 'more information'],
                    },
                ],
            }
        };

        let activeTab = 'dashboard';
        let drafts = initialDrafts;
        let activeDraftId = drafts[0].id;
        let filteredSentiment = null;
        let isDraftsMenuOpen = false;

        let chatMessages = {
            [drafts[0].id]: [
                { id: 1, type: 'bot', message: 'Hello! I’m here to help you with legal guidance. Ask me anything about laws and regulations.' },
            ],
            [drafts[1].id]: [
                { id: 1, type: 'bot', message: 'Welcome to the urban policy assistant. I can help with information on transport regulations and city planning laws.' },
            ],
        };
        let chatInput = '';

        function generateLegalResponse(q) {
            const pool = [
                'Under Article 19, citizens have the right to express their opinions.',
                'Per the RTI Act 2005, a citizen can request information from a public authority.',
                'The Consumer Protection Act 2019 safeguards consumer rights against unfair trade practices.',
            ];
            return pool[Math.floor(Math.random() * pool.length)];
        }

        function handleSendMessage() {
            const chatInputEl = document.getElementById('chat-input');
            const message = chatInputEl.value.trim();
            if (!message) return;
            chatInputEl.value = '';
            
            const draftChat = chatMessages[activeDraftId] || [];
            const userMsg = { id: Date.now(), type: 'user', message: message };
            chatMessages = { ...chatMessages, [activeDraftId]: [...draftChat, userMsg] };
            renderContent();

            setTimeout(() => {
                const botMsg = { id: Date.now() + 1, type: 'bot', message: generateLegalResponse(message) };
                const updatedDraftChat = [...(chatMessages[activeDraftId] || []), botMsg];
                chatMessages = { ...chatMessages, [activeDraftId]: updatedDraftChat };
                renderContent();
            }, 1000);
        }

        function renderDraftList(targetId) {
            const listEl = document.getElementById(targetId);
            const draftHtml = drafts.map(d => {
                const isActive = activeDraftId === d.id;
                return `
                    <div onclick="setActiveDraft(${d.id})" class="p-4 cursor-pointer transition-all duration-300 rounded-lg mx-4 mb-2
                        ${isActive ? 'bg-slate-700 shadow-lg border border-indigo-500' : 'hover:bg-slate-800 hover:shadow-md'}"
                    >
                        <h3 class="font-semibold text-white">E-Consultation</h3>
                        <p class="text-xs text-slate-400 mt-1">${d.description}</p>
                        <p class="text-[11px] text-slate-500 mt-2">${d.startDate} &rarr; ${d.endDate}</p>
                    </div>
                `;
            }).join('');

            listEl.innerHTML = `
                <div class="p-4 pb-0">
                    <div class="flex items-center justify-between pb-2 border-b border-slate-700">
                        <h2 class="text-sm font-semibold text-slate-400 uppercase">All Drafts</h2>
                        <button class="flex items-center gap-1 px-3 py-1 text-xs rounded-lg font-medium border border-indigo-500 text-indigo-400 transition-colors hover:bg-indigo-900 active:scale-95">
                            ${lucideIcons.Plus} New
                        </button>
                    </div>
                </div>
                <div class="mt-4">
                    ${draftHtml}
                </div>
            `;
        }

        function renderMobileDraftMenu() {
            const menuEl = document.getElementById('drafts-menu');
            const menuItemsHtml = drafts.map(d => `
                <div onclick="setActiveDraft(${d.id})" class="block px-4 py-3 text-sm text-white hover:bg-slate-700 cursor-pointer">
                    ${d.title}
                </div>
            `).join('');
            menuEl.innerHTML = menuItemsHtml;
        }

        function toggleDraftsMenu() {
            isDraftsMenuOpen = !isDraftsMenuOpen;
            document.getElementById('drafts-menu').classList.toggle('hidden', !isDraftsMenuOpen);
        }

        function setActiveDraft(id) {
            activeDraftId = id;
            filteredSentiment = null;
            renderContent();
            renderDraftList('draft-list-desktop');
            toggleDraftsMenu();
        }

        function setFilteredSentimentAndTab(sentiment, tab) {
            filteredSentiment = sentiment;
            activeTab = tab;
            renderContent();
            updateTabs();
        }

        function renderSummary() {
            const currentData = draftData[activeDraftId];
            const draft = drafts.find(d => d.id === activeDraftId);
            const positiveCount = currentData.commentData.filter(c => c.sentiment === 'Positive').length;
            const negativeCount = currentData.commentData.filter(c => c.sentiment === 'Negative').length;
            const neutralCount = currentData.commentData.filter(c => c.sentiment === 'Neutral').length;
            const totalCount = currentData.commentData.length;

            const positivePercentage = ((positiveCount / totalCount) * 100).toFixed(0);
            const negativePercentage = ((negativeCount / totalCount) * 100).toFixed(0);
            const neutralPercentage = ((neutralCount / totalCount) * 100).toFixed(0);

            return Card(`
                <h3 class="text-sm font-semibold text-gray-700 mb-2">Feedback Summary</h3>
                <p class="text-xs text-gray-600">
                    Citizens largely welcome the direction of <span class="font-bold text-gray-800">${draft.title}</span>. Key positives:
                    affordability, wider coverage. Key concerns: implementation timeline, rural reach.
                </p>
                <div class="flex flex-wrap items-center gap-2 mt-3">
                    ${Pill(`${positivePercentage} % Positive`, `setFilteredSentimentAndTab('Positive', 'comments')`, `
                      ${filteredSentiment === 'Positive' ? 'bg-teal-600 text-white' : 'bg-teal-50 text-teal-700 border border-teal-100 hover:bg-teal-100'}
                    `)}
                    ${Pill(`${negativePercentage} % Negative`, `setFilteredSentimentAndTab('Negative', 'comments')`, `
                      ${filteredSentiment === 'Negative' ? 'bg-red-700 text-white' : 'bg-red-50 text-red-700 border border-red-100 hover:bg-red-100'}
                    `)}
                    ${Pill(`${neutralPercentage} % Neutral`, `setFilteredSentimentAndTab('Neutral', 'comments')`, `
                      ${filteredSentiment === 'Neutral' ? 'bg-slate-500 text-white' : 'bg-slate-50 text-slate-700 border border-slate-100 hover:bg-slate-100'}
                    `)}
                </div>
            `, 'p-4 mb-4');
        }

        function renderDashboard() {
            const currentData = draftData[activeDraftId];
            const statsHtml = currentData.sentimentStats.map(s => {
                return Card(`
                    <div class="absolute -top-6 -right-6 w-24 h-24 rounded-full opacity-10 ${s.color}"></div>
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">${s.title}</p>
                            <p class="text-3xl sm:text-4xl font-bold text-gray-800 mt-1">${s.value}</p>
                            <p class="text-xs ${s.trend === 'up' ? 'text-teal-600' : 'text-red-600'}">
                                <span class="font-semibold">${s.change}</span> since last week
                            </p>
                        </div>
                        <div class="p-4 rounded-full ${s.color} bg-opacity-20">
                            <span class="${s.color.replace('bg-', 'text-')}">${lucideIcons[s.icon]}</span>
                        </div>
                    </div>
                `, 'p-6 relative overflow-hidden');
            }).join('');

            const wordCloudHtml = (() => {
                const maxFreq = Math.max(...currentData.wordCloudData.map(item => item.frequency));
                const minFreq = Math.min(...currentData.wordCloudData.map(item => item.frequency));
                return currentData.wordCloudData.map(w => {
                    const fontSize = 14 + (w.frequency - minFreq) / (maxFreq - minFreq) * (48 - 14);
                    const duration = Math.random() * 2 + 3; // 3 to 5 seconds
                    const delay = Math.random() * 1.5; // 0 to 1.5 seconds
                    return `<span class="word-float font-bold text-indigo-700 hover:text-indigo-800 cursor-pointer transition-colors" style="font-size: ${fontSize}px; opacity: ${0.7 + w.frequency / 100}; animation-duration: ${duration}s; animation-delay: ${delay}s;" title="${w.frequency} mentions">${w.word}</span>`;
                }).join('');
            })();

            const recentCommentsHtml = currentData.commentData.slice(0, 3).map(c => {
                const sentimentColor = c.sentiment === 'Positive' ? 'bg-teal-600' : c.sentiment === 'Negative' ? 'bg-red-700' : 'bg-slate-500';
                return `
                    <div class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                        <div class="w-2.5 h-2.5 rounded-full mt-2 shrink-0 ${sentimentColor}"></div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-800">${c.author}</p>
                            <p class="text-xs text-gray-600 line-clamp-2 mt-0.5">${c.comment}</p>
                        </div>
                    </div>
                `;
            }).join('');
            
            const draftChatHtml = (chatMessages[activeDraftId] || []).map(m => `
                <div class="flex ${m.type === 'user' ? 'justify-end' : 'justify-start'}">
                    <span class="inline-block max-w-[80%] px-4 py-2 rounded-xl shadow-lg ${m.type === 'user' ? 'bg-indigo-700 text-white rounded-br-none' : 'bg-white border border-gray-200 text-gray-800 rounded-bl-none'}">
                        ${m.message}
                    </span>
                </div>
            `).join('');


            return `
                <!-- stats -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    ${statsHtml}
                </div>
                ${renderSummary()}
                <!-- word cloud + activity -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    ${Card(`
                        <h3 class="text-sm font-semibold text-gray-700 mb-4">Common Words</h3>
                        <div class="h-56 flex flex-wrap items-center justify-center gap-4 p-4 bg-gray-50 rounded-xl border border-gray-200">
                            ${wordCloudHtml}
                        </div>
                    `, 'lg:col-span-2')}
                    ${Card(`
                        <h3 class="text-sm font-semibold text-gray-700 mb-4">Recent Comments</h3>
                        <div class="space-y-4">
                            ${recentCommentsHtml}
                        </div>
                    `)}
                </div>
                <!-- legal bot -->
                ${Card(`
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        ${lucideIcons.Bot} AI Legal Assistant
                    </h3>
                    <div id="chat-messages" class="h-72 border rounded-xl bg-gray-50 p-4 overflow-y-auto mb-4 text-sm space-y-3 shadow-inner">
                        ${draftChatHtml}
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input id="chat-input" type="text" placeholder="Ask a legal question…" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" onkeypress="if(event.key==='Enter') handleSendMessage()"/>
                        ${Btn(`${lucideIcons.Send} Send`, 'handleSendMessage()', 'bg-indigo-700 text-white border-indigo-700 hover:bg-indigo-800 shadow-md')}
                    </div>
                `, 'mt-8')}
            `;
        }
        
        function renderComments() {
            const currentData = draftData[activeDraftId];
            const draft = drafts.find(d => d.id === activeDraftId);
            const filteredComments = filteredSentiment ? currentData.commentData.filter(c => c.sentiment === filteredSentiment) : currentData.commentData;

            const positiveCount = currentData.commentData.filter((c) => c.sentiment === 'Positive').length;
            const negativeCount = currentData.commentData.filter((c) => c.sentiment === 'Negative').length;
            const neutralCount = currentData.commentData.filter((c) => c.sentiment === 'Neutral').length;
            const totalCount = currentData.commentData.length;

            const tableRowsHtml = filteredComments.map(c => `
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="py-4 px-4">
                        <div class="flex items-center gap-3">
                            <div class="w-9 h-9 rounded-full bg-indigo-500 text-white flex items-center justify-center text-xs font-semibold shrink-0">
                                ${c.author.split(' ').map(n => n[0]).join('')}
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">${c.author}</p>
                                <p class="text-xs text-gray-500">${c.email}</p>
                            </div>
                        </div>
                    </td>
                    <td class="py-4 px-4 max-w-[200px] truncate">${c.comment}</td>
                    <td class="py-4 px-4">
                        ${Pill(c.sentiment, '', `${c.sentiment === 'Positive' ? 'bg-teal-50 text-teal-700' : c.sentiment === 'Negative' ? 'bg-red-50 text-red-700' : 'bg-slate-50 text-slate-700'}`)}
                    </td>
                    <td class="py-4 px-4 text-gray-500">${c.date}</td>
                    <td class="py-4 px-4 flex items-center gap-2">
                        ${Btn(lucideIcons.Eye, '', 'p-2 border-gray-200 hover:bg-gray-100')}
                        ${Btn(lucideIcons.Edit, '', 'p-2 border-gray-200 hover:bg-gray-100')}
                        ${Btn(lucideIcons.Trash2, '', 'p-2 border-red-200 text-red-600 hover:bg-red-50')}
                    </td>
                </tr>
            `).join('');

            return `
                ${Card(`
                    <div class="flex items-center justify-between mb-4 flex-wrap gap-2">
                        <h3 class="text-lg font-semibold text-gray-700">Comments on ${draft.title}</h3>
                        <div class="flex gap-2">
                            ${filteredSentiment ? Btn(`${lucideIcons.Filter} Show All`, `setFilteredSentimentAndTab(null, 'comments')`) : ''}
                            ${Btn(`${lucideIcons.Download} Export`)}
                        </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div class="p-4 bg-teal-50 rounded-xl border border-teal-200">
                            <p class="text-3xl font-bold text-teal-700">${positiveCount}</p>
                            <p class="text-xs text-gray-500 uppercase mt-1">Positive</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-xl border border-red-200">
                            <p class="text-3xl font-bold text-red-700">${negativeCount}</p>
                            <p class="text-xs text-gray-500 uppercase mt-1">Negative</p>
                        </div>
                        <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                            <p class="text-3xl font-bold text-slate-700">${neutralCount}</p>
                            <p class="text-xs text-gray-500 uppercase mt-1">Neutral</p>
                        </div>
                        <div class="p-4 bg-indigo-50 rounded-xl border border-indigo-200">
                            <p class="text-3xl font-bold text-indigo-700">${totalCount}</p>
                            <p class="text-xs text-gray-500 uppercase mt-1">Total</p>
                        </div>
                    </div>
                `, 'mb-6')}
                ${Card(`
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead>
                                <tr class="border-b text-left text-xs text-gray-500 uppercase bg-gray-50">
                                    <th class="py-3 px-4 rounded-tl-xl font-semibold">Author</th>
                                    <th class="py-3 px-4 font-semibold">Comment</th>
                                    <th class="py-3 px-4 font-semibold">Sentiment</th>
                                    <th class="py-3 px-4 font-semibold">Date</th>
                                    <th class="py-3 px-4 rounded-tr-xl font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${tableRowsHtml}
                            </tbody>
                        </table>
                    </div>
                `)}
            `;
        }

        function renderAnalytics() {
            const currentData = draftData[activeDraftId];
            const draft = drafts.find(d => d.id === activeDraftId);
            const draftChatHtml = (chatMessages[activeDraftId] || []).map(m => `
                <div class="flex ${m.type === 'user' ? 'justify-end' : 'justify-start'}">
                    <span class="inline-block max-w-[80%] px-4 py-2 rounded-xl shadow-lg ${m.type === 'user' ? 'bg-indigo-700 text-white rounded-br-none' : 'bg-white border border-gray-200 text-gray-800 rounded-bl-none'}">
                        ${m.message}
                    </span>
                </div>
            `).join('');

            const positiveCount = currentData.commentData.filter((c) => c.sentiment === 'Positive').length;
            const negativeCount = currentData.commentData.filter((c) => c.sentiment === 'Negative').length;
            const neutralCount = currentData.commentData.filter((c) => c.sentiment === 'Neutral').length;
            const totalCount = currentData.commentData.length;

            const posPercent = ((positiveCount / totalCount) * 100).toFixed(0);
            const negPercent = ((negativeCount / totalCount) * 100).toFixed(0);
            const neuPercent = ((neutralCount / totalCount) * 100).toFixed(0);
            
            const posDashoffset = 0;
            const negDashoffset = 100 - posPercent;
            const neuDashoffset = 100 - posPercent - negPercent;

            return `
                ${Card(`
                    <div class="flex items-center justify-between mb-4 flex-wrap gap-2">
                        <h3 class="text-lg font-semibold text-gray-700">Analytics for ${draft.title}</h3>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <p class="text-2xl sm:text-3xl font-bold text-gray-800">7.2 / 10</p>
                            <p class="text-xs text-gray-500 uppercase mt-1">Avg. sentiment</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <p class="text-2xl sm:text-3xl font-bold text-gray-800">68 %</p>
                            <p class="text-xs text-gray-500 uppercase mt-1">Response rate</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <p class="text-2xl sm:text-3xl font-bold text-gray-800">Healthcare</p>
                            <p class="text-xs text-gray-500 uppercase mt-1">Top topic</p>
                        </div>
                        <div class="p-4 bg-teal-50 rounded-xl border border-teal-200">
                            <p class="text-2xl sm:text-3xl font-bold text-teal-700">&uarr; 23 %</p>
                            <p class="text-xs text-gray-500 uppercase mt-1">Engagement</p>
                        </div>
                    </div>
                `, 'mb-6')}
                ${Card(`
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        ${lucideIcons.Bot} AI Legal Assistant
                    </h3>
                    <div id="chat-messages" class="h-72 border rounded-xl bg-gray-50 p-4 overflow-y-auto mb-4 text-sm space-y-3 shadow-inner">
                        ${draftChatHtml}
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input id="chat-input" type="text" placeholder="Ask a legal question…" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" onkeypress="if(event.key==='Enter') handleSendMessage()"/>
                        ${Btn(`${lucideIcons.Send} Send`, 'handleSendMessage()', 'bg-indigo-700 text-white border-indigo-700 hover:bg-indigo-800 shadow-md')}
                    </div>
                `, 'mb-6')}
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    ${Card(`
                        <h3 class="text-sm font-semibold text-gray-700 mb-3">Sentiment Distribution</h3>
                        <div class="h-48 flex items-center justify-center">
                            <div class="relative w-40 h-40">
                                <svg viewBox="0 0 36 36" class="w-full h-full transform -rotate-90">
                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e5e7eb" stroke-width="3" />
                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#0d9488" stroke-width="3" stroke-dasharray="${posPercent}, 100" stroke-dashoffset="0" />
                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#b91c1c" stroke-width="3" stroke-dasharray="${negPercent}, 100" stroke-dashoffset="${negDashoffset}" />
                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#64748b" stroke-width="3" stroke-dasharray="${neuPercent}, 100" stroke-dashoffset="${neuDashoffset}" />
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center text-3xl font-bold">
                                    <span class="text-teal-600">${posPercent}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-wrap justify-center gap-3 mt-4">
                            ${Pill(`Pos ${posPercent} %`, '', 'bg-teal-50 text-teal-700 border border-teal-100')}
                            ${Pill(`Neg ${negPercent} %`, '', 'bg-red-50 text-red-700 border border-red-100')}
                            ${Pill(`Neu ${neuPercent} %`, '', 'bg-slate-50 text-slate-700 border border-slate-100')}
                        </div>
                    `)}
                    ${Card(`
                        <h3 class="text-sm font-semibold text-gray-700 mb-3">Policy Performance</h3>
                        <div class="space-y-4">
                            ${['Healthcare', 'Education', 'Tax', 'Urban', 'Environment'].map((p, i) => `
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600 w-24 shrink-0">${p}</span>
                                    <div class="flex-1 mx-3 h-2 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-full bg-indigo-700 rounded-full" style="width: ${80 - i * 10}%;"></div>
                                    </div>
                                    <span class="font-bold text-gray-800 w-10 shrink-0 text-right">${80 - i * 10} %</span>
                                </div>
                            `).join('')}
                        </div>
                    `)}
                </div>
            `;
        }

        function renderSettings() {
            return Card(`
                <h3 class="text-lg font-semibold text-gray-700">Settings</h3>
                <p class="text-sm text-gray-600 mt-2">Configure notification preferences, export schedules, etc.</p>
            `);
        }
        
        function updateDraftInfo() {
            const draft = drafts.find(d => d.id === activeDraftId);
            document.getElementById('draft-title').textContent = draft.title;
            document.getElementById('draft-dates').textContent = `${draft.startDate} → ${draft.endDate}`;
        }
        
        function updateTabs() {
            document.querySelectorAll('nav button').forEach(button => {
                if (button.dataset.tab === activeTab) {
                    button.classList.add('bg-indigo-700', 'text-white', 'shadow-md', 'hover:bg-indigo-800');
                    button.classList.remove('text-slate-300', 'lg:text-gray-600', 'hover:bg-slate-700', 'lg:hover:bg-gray-200');
                } else {
                    button.classList.remove('bg-indigo-700', 'text-white', 'shadow-md', 'hover:bg-indigo-800');
                    button.classList.add('text-slate-300', 'lg:text-gray-600', 'hover:bg-slate-700', 'lg:hover:bg-gray-200');
                }
            });
        }

        function renderContent() {
            const mainContentEl = document.getElementById('main-content');
            updateDraftInfo();
            updateTabs();
            switch (activeTab) {
                case 'dashboard':
                    mainContentEl.innerHTML = renderDashboard();
                    break;
                case 'comments':
                    mainContentEl.innerHTML = renderComments();
                    break;
                case 'analytics':
                    mainContentEl.innerHTML = renderAnalytics();
                    break;
                case 'settings':
                    mainContentEl.innerHTML = renderSettings();
                    break;
                default:
                    mainContentEl.innerHTML = '';
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('nav button').forEach(button => {
                button.addEventListener('click', () => {
                    activeTab = button.dataset.tab;
                    if (activeTab === 'dashboard' || activeTab === 'analytics' || activeTab === 'settings') {
                        filteredSentiment = null;
                    }
                    renderContent();
                });
            });

            document.getElementById('drafts-toggle').addEventListener('click', toggleDraftsMenu);
            document.body.addEventListener('click', (event) => {
                const draftsMenu = document.getElementById('drafts-menu');
                const draftsToggle = document.getElementById('drafts-toggle');
                if (isDraftsMenuOpen && !draftsMenu.contains(event.target) && !draftsToggle.contains(event.target)) {
                    toggleDraftsMenu();
                }
            });

            renderDraftList('draft-list-desktop');
            renderMobileDraftMenu();
            renderContent();
        });
    </script>
</body>
</html>
